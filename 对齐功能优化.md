# 对齐语法的 Pipe Syntax 实现改动
希望能够结合/original/randy's_img.css和原始项目obsidian-image-converter的对齐功能的较好结合，希望能够改为本地化实现来增强文件的可移植性，并且为了增强跨平台的兼容性，希望通过pipe syntax来实现对齐功能。

## 语法设计

考虑到需要兼容obsidian中引用图片的两种常见语法wiki和markdown，这里对图片的对齐应该兼顾这两种语法的实现，进一步考虑到本项目需要利用到限定图片显示大小的pipe syntax，这里考虑以下几种情景

1. 网络图片
    - wiki 语法
        ```
        [[url|alt|align|size]]
        ```
    - markdown 语法
        ```
        ![alt|align|size](url)
        ```
2. 本地图片
    - wiki 语法
        ```
        [[path|alt|align|size]]
        ```
    - markdown 语法
        ```
        ![alt|align|size](path)
        ```
其中需要注意的是：
1. 对网络图片和本地图片应该都具有处理能力，注意功能实现准确与健壮性
2. pipe syntax 属性：
    - align ：结合randy's_img.css和obsidian-image-converter的对齐功能优点实现，考虑设置为 left、center、right、left-wrap、right-wrap
    - size 为图片的显示大小，请注意充分考虑缺省情况下的代码健壮性，考虑以下情况：
        - |长x宽
        - |长
        - |长x
        - |x宽
    - alt 为图片的题注，这部分的显示功能由caption模块实现
3. 允许多个pipe syntax属性同时存在的情况，此时应当高效、准确、健壮地处理，谨防错误的混淆实际的pipe syntax属性，并且其先后顺序或者缺省情况下都不应该影响pipe syntax属性的正确渲染


## 用户交互
### 设置面板

从原来老的原始的对齐设置改为
1. 一个全局的默认对齐方式下拉菜单（左、中、右），当图片的align属性为空时，使用默认对齐方式（默认值是居中对齐）
2. 编辑模式下，启用包围语法wrap的开关，如果关闭则left-wrap渲染为left，right-wrap渲染为right，这将有利于避免编辑模式下包围语法的干扰
！注意：保持设置面板的UI风格一致性

### 右键菜单
改变原有菜单的对齐设置为：仍然是控制图片的对齐方式，但是
一般显示设置对齐方式的一级选项下的左、中、右三个二级选项，不显示left-wrap、right-wrap，仅当某个图片被设置为了左对齐或者右对齐时，或者被设置为了左包围或者右包围时，会在原本的左中右二级选项下方多出一个是否包围的二级选项

## 代码实现
### i18n
注意i18n的实现，同步所有前端简体中文和英文显示内容变更

### pipe syntax相关功能模块检查
1. 因为涉及到pipe syntax的填写、提取、渲染等操作，需要检查所有与pipe syntax相关的功能模块，包括图片大小的读写（Resizer模块）、对齐方式的读写（Aligner模块）、alt的读写（Caption模块）等，如果有必要的话可以考虑提取pipe syntax的读写模块以供其他模块复用，如果涉及到正则表达式的使用，需要充分考虑正则表达式的健壮性，并且正则应当在RegexPattern中维护
2. css相关代码检查，需要检查所有与css相关的代码，例如图片的对齐方式的css代码，确保css风格合理，在编辑和阅读模式下都能得到完善和具有较好一致性的渲染，主要的实现可以多参考Randy's_img.css和obsidian-image-converter的实现，但是不必完全照搬

## 分析检查功能实现

1. 连接替换相关代码检查，需要检查所有与连接替换相关的代码，例如图床upload功能的上传后替换为网络链接和下载后替换为本地地址的代码，确保所有替换前和alt和pipe syntax信息被正确的保留
2. 图片相关读、写、查询操作稳健性分析，确保不同语法（wiki和markdown语法）、含有不同组合和顺序Pipe Syntax语法的，以本地地址和在线链接表示的图片都能被不同模块正确的读、写和索引
3. 渲染正确性分析，确保图片的大小、题注和对齐功能能够以符合逻辑的css方式渲染，并且二者不能互相冲突且有较好的风格


### 完成后的测试和维护
1. 构建包含不同pipe syntax属性组合的测试文件，测试文件中包含网络图片和本地图片，充分考虑不同语法（wiki和markdown语法）、含有不同组合和顺序Pipe Syntax语法的，以本地地址和在线链接表示的图片的情况
2. 进行题注、大小、对齐ccs的正确性和兼容性测试
3. 当且仅当确保功能完好的实现之后可以对整个项目进行全面的检查分析，确保没有潜在问题和待优化项目
4. 在准备结束时应当对代码结构进行优化，确保没有已经废弃的实现、函数、变量和文件，确保代码风格合理
